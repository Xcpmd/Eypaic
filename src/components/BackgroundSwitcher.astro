---
// 背景下载组件
---

<div class="background-switcher" id="background-switcher">
  <button class="bg-switch-btn" id="bg-download-btn" title="下载当前背景">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
      <polyline points="7 10 12 15 17 10"></polyline>
      <line x1="12" y1="15" x2="12" y2="3"></line>
    </svg>
  </button>
</div>

<style>
  .background-switcher {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 100;
  }
  
  .bg-switch-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(5px);
    border-radius: 50%;
    border: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    color: #333;
  }
  
  .bg-switch-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
  }
  
  .bg-switch-btn:active {
    transform: scale(0.95);
  }
  
  /* 暗色主题样式 */
  :global(.dark) .bg-switch-btn {
    background: rgba(30, 30, 30, 0.8);
    color: #fff;
  }
  
  /* 移动端样式 */
  @media (max-width: 768px) {
    .background-switcher {
      bottom: 16px;
      right: 16px;
    }
    
    .bg-switch-btn {
      width: 40px;
      height: 40px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const bgDownloadBtn = document.getElementById('bg-download-btn');
    
    if (bgDownloadBtn) {
      bgDownloadBtn.addEventListener('click', () => {
        // 添加点击动画效果
        bgDownloadBtn.style.transform = 'scale(0.9)';
        setTimeout(() => {
          bgDownloadBtn.style.transform = '';
        }, 200);
        
        // 获取当前背景图片URL
        const bgContainer = document.querySelector('.background-container');
        if (!bgContainer) {
          console.error('Background container not found');
          return;
        }
        
        const bgStyle = bgContainer.style.backgroundImage;
        if (!bgStyle || bgStyle === 'none') {
          console.error('No background image set');
          return;
        }
        
        // 从background-image样式中提取URL
        const urlMatch = bgStyle.match(/url\(['"]?([^'"]+)['"]?\)/);
        if (!urlMatch || !urlMatch[1]) {
          console.error('Could not extract background image URL');
          return;
        }
        
        const imageUrl = urlMatch[1];
        
        // 创建下载链接
        fetch(imageUrl)
          .then(response => response.blob())
          .then(blob => {
            // 从URL中提取文件名
            const urlParts = imageUrl.split('/');
            const filename = urlParts[urlParts.length - 1];
            
            // 创建下载链接
            const downloadUrl = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = downloadUrl;
            a.download = filename || 'background-image';
            document.body.appendChild(a);
            a.click();
            
            // 清理
            setTimeout(() => {
              document.body.removeChild(a);
              window.URL.revokeObjectURL(downloadUrl);
            }, 100);
          })
          .catch(error => {
            console.error('Error downloading background image:', error);
            
            // 如果直接下载失败，尝试在新窗口中打开图片
            window.open(imageUrl, '_blank');
          });
      });
    }
  });
</script>